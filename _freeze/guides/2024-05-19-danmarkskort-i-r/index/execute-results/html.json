{
  "hash": "cfd12ae72ae68783b2d15c82a8e8a510",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Nemt Danmarkskort i R\ncitation:\n  url: https://aleksanderbl.dk/guides/2024-05-19-danmarkskort-i-r\nbibliography: refs.bib\nexecute: \n  echo: true\n  output: false\n  cache: true\n  eval: false\nlink-external-icon: true\nlink-external-newwindow: true\nother-links:\n  - text: Samlet script\n    icon: code\n    href: https://github.com/aleksanderbl29/aleksanderbldk/blob/main/guides/2024-06-29-danmarkskort-i-r/kort.r\ndraft: false\ndate: 2024-06-29\n---\n\n\n## Baggrund\n\nDa jeg skulle lære at lave kort i R, lavede jeg et par hurtige googlesøgninger, hvor jeg kom frem til en god guide lavet af Mikkel Freltoft @krogsholm2021. Jeg opdagede dog hurtigt, at guiden er out-of-date - og derfor skriver jeg denne guide.\n\n## Pakker\n\nI R-universet findes der flere pakker til at arbejde med kort. Jeg har valgt at bruge `sf`som den pakke jeg sætter mig ind i, hvad kan. De fleste kan grundlæggende det samme og er bygget op omkring `geometry`, der er den kolonne (eller variabel) i en dataframe, der indeholder figurerne til kortet.\n\nFørst indlæser vi alle pakker der skal bruges.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)      # Her får vi %>%, ggplot2 og andre smarte funktioner.\nlibrary(sf)             # Skal bruges til at arbejde med \"simple features\" (figurer).\n```\n:::\n\n\n## Data\n\nFor at tegne et præcist danmarkskort kan vi hente `geojson` data fra [Styrelsen for Dataforsyning og Infrastruktur](https://sdfi.dk/). De udstiller en udmærket `API` der kan levere kortdata til os. For at vi kan benytte en `API` i `R` skal vi først definere et `URL` og dernæst bede om at downloade den fil der hører til på den hjemmeside.\n\n::: {.aside}\nDu behøver *ikke* at vide hvad en `API` er for at kunne gennemføre denne guide.\n:::\n\n1. Først definerer vi `API`ens `URL`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Gemmer URL til API-kald\nurl <- \"https://api.dataforsyningen.dk/afstemningsomraader?format=geojson\"\n```\n:::\n\n\n2. Dernæst beder vi `R` om at downloade den efterspurgte fil til en midlertidig placering i computerens hukommelse.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Skaber midlertidig fil\ngeofile <- tempfile()\n\n# Henter geojson til tempfile\ndownload.file(url, geofile)\n```\n:::\n\n\nVi bruger funktionen `download.file()` og giver den `API`ens `URL` og den midlertidige dataplacering, hvor vi ønsker dataene hentet til.\n\n3. Til sidst omformer vi `geoJSON` til et `sf` format som `R` kan forstå.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Læser datafilen ind i R\ngeodata_st <- st_read(geofile)\nafstemningssteder_geodata <- st_as_sf(geodata_st)\n```\n:::\n\n\n::: {.aside}\nHer omformes først til `st` og dernæst til `sf`.\n:::\n\nNu har vi en dataframe i `afstemningssteder_geodata` der indeholder de figurer vi skal bruge for at lave et danmarkskort!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvind_afstemningssteder_geodata <- rmapshaper::ms_simplify(vind_afstemningssteder_geodata, keep = 0.01, keep_shapes = TRUE)\n\naarhus_afstemningssteder <- vind_afstemningssteder_geodata %>%\n  filter(kommunenavn == \"Aarhus\") %>%\n  ggplot(aes(fill = navn)) +\n  geom_sf() +\n  ggthemes::theme_map() +\n  theme(legend.position = \"none\")\n\nbw_afstemningssteder <- ggplot(vind_afstemningssteder_geodata) +\n  geom_sf() +\n  ggthemes::theme_map() +\n  labs(title = \"Afstemningssteder i Danmark\", caption = \"Kilde: DAWA/DAGI\") +\n  theme(legend.position = \"none\", title = element_text(size = 20))\n```\n:::\n\n\n::: {.aside}\nHer indlæser vi `rmapshaper::ms_simplify()` med pakkens navn for at slippe for at indlæse hele pakken - Vi skal nemlig ikke bruge det hele! Det samme har vi gjort med `ggthemes::theme_map()`, fordi der kun skal bruges det ene *theme*\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\naarhus_afstemningssteder\nbw_afstemningssteder\n```\n:::\n\n\n## Samlet kode\n\nAlt hvad jeg har gennemgået i denne guide kan findes i et samlet `r`-script [på min github](https://github.com/aleksanderbl29/aleksanderbldk/blob/main/guides/2024-06-29-danmarkskort-i-r/kort.r).\n\n## Gammelt kode\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog_info(\"Starter download af geoJSON\")\nstarttid <- Sys.time()\n\nsluttid <- Sys.time()\nlog_info(\"GeoJSON downloadet\")\n\ndownload_tid <- sluttid - starttid\nlog_info(paste(\"Det tog\", round(download_tid, 3), \"minutter at downloade\"))\n\n# sf_use_s2(FALSE)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}